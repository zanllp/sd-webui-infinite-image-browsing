import{d as se,$ as x,aw as ne,bQ as ae,bP as U,o as i,y as b,q as A,c as o,r as e,bT as le,p as m,N as y,m as g,n as r,x as I,v as f,C as w,s as T,t as ie,L as oe,ax as re,al as de,ai as ue,U as ce,V as pe,Q as ve,R as me,X as ge}from"./index-b44dfcf8.js";import{L as fe,R as we,f as ke,S as xe}from"./fullScreenContextMenu-67c7b1b8.js";/* empty css              */import{g as be,F as ye}from"./FileItem-c84a61c8.js";import{b as K,c as Ie,f as N,u as Ce}from"./db-f71a84c3.js";import{c as he,u as _e}from"./hook-8fa8389e.js";import"./shortcut-0fe96b62.js";const Se="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Me=["src"],$e={class:"hint"},ze={key:1,class:"preview-switch"},De=se({__name:"SubstrSearch",setup(Be){const p=x(!1),u=x(""),C=he(n=>p.value?N("",n,u.value):N(u.value,n)),{queue:d,images:l,onContextMenuClickU:h,stackViewEl:P,previewIdx:c,previewing:_,onPreviewVisibleChange:q,previewImgMove:S,canPreview:M,itemSize:$,gridItems:L,showGenInfo:v,imageGenInfo:z,q:G,multiSelectedIdxs:O,onFileItemClick:Q,scroller:D,showMenuIdx:k,onFileDragStart:H,onFileDragEnd:W,cellWidth:X,onScroll:B}=_e(C),s=x();ne(async()=>{s.value=await K(),s.value.img_count&&s.value.expired&&V()});const V=ae(()=>d.pushAction(async()=>(await Ce(),s.value=await K(),s.value)).res),E=async()=>{await C.reset({refetch:!0}),await re(),B(),D.value.scrollToItem(0),l.value.length||de.info(ue("fuzzy-search-noResults"))};U("returnToIIB",async()=>{const n=await d.pushAction(Ie).res;s.value.expired=n.expired}),U("searchIndexExpired",()=>s.value&&(s.value.expired=!0));const j=()=>{p.value=!p.value};return(n,t)=>{const J=ce,F=pe,Y=ve,Z=me,ee=xe;return i(),b("div",{class:"container",ref_key:"stackViewEl",ref:P},[s.value?(i(),b("div",{key:0,class:"search-bar",onKeydown:t[2]||(t[2]=A(()=>{},["stop"]))},[o(J,{value:u.value,"onUpdate:value":t[0]||(t[0]=a=>u.value=a),placeholder:n.$t("fuzzy-search-placeholder")+" "+n.$t("regexSearchEnabledHint"),disabled:!e(d).isIdle,onKeydown:le(E,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),m("div",{class:y(["regex-icon",{selected:p.value}]),onKeydown:t[1]||(t[1]=A(()=>{},["stop"])),onClick:j,title:"Use Regular Expression"},[m("img",{src:e(Se)},null,8,Me)],34),s.value.expired||!s.value.img_count?(i(),g(F,{key:0,onClick:e(V),loading:!e(d).isIdle,type:"primary"},{default:r(()=>[I(f(s.value.img_count===0?n.$t("generateIndexHint"):n.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(i(),g(F,{key:1,type:"primary",onClick:E,loading:!e(d).isIdle,disabled:!u.value},{default:r(()=>[I(f(n.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):w("",!0),o(ee,{size:"large",spinning:!e(d).isIdle},{default:r(()=>[o(Z,{visible:e(v),"onUpdate:visible":t[4]||(t[4]=a=>T(v)?v.value=a:null),width:"70vw","mask-closable":"",onOk:t[5]||(t[5]=a=>v.value=!1)},{cancelText:r(()=>[]),default:r(()=>[o(Y,{active:"",loading:!e(G).isIdle},{default:r(()=>[m("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:t[3]||(t[3]=a=>e(ie)(e(z)))},[m("div",$e,f(n.$t("doubleClickToCopy")),1),I(" "+f(e(z)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(l)?(i(),g(e(be),{key:0,ref_key:"scroller",ref:D,class:"file-list",items:e(l),"item-size":e($).first,"key-field":"fullpath","item-secondary-size":e($).second,gridItems:e(L),onScroll:e(B)},{default:r(({item:a,index:R})=>[o(ye,{idx:R,file:a,"show-menu-idx":e(k),"onUpdate:showMenuIdx":t[6]||(t[6]=te=>T(k)?k.value=te:null),onFileItemClick:e(Q),"full-screen-preview-image-url":e(l)[e(c)]?e(oe)(e(l)[e(c)]):"","cell-width":e(X),selected:e(O).includes(R),onContextMenuClick:e(h),onDragstart:e(H),onDragend:e(W),onPreviewVisibleChange:e(q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):w("",!0),e(_)?(i(),b("div",ze,[o(e(fe),{onClick:t[7]||(t[7]=a=>e(S)("prev")),class:y({disable:!e(M)("prev")})},null,8,["class"]),o(e(we),{onClick:t[8]||(t[8]=a=>e(S)("next")),class:y({disable:!e(M)("next")})},null,8,["class"])])):w("",!0)]),_:1},8,["spinning"]),e(_)&&e(l)&&e(l)[e(c)]?(i(),g(ke,{key:1,file:e(l)[e(c)],idx:e(c),onContextMenuClick:e(h)},null,8,["file","idx","onContextMenuClick"])):w("",!0)],512)}}});const Ke=ge(De,[["__scopeId","data-v-a1cb02be"]]);export{Ke as default};
