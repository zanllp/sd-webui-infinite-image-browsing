import{c as s,A as Me,d as ze,r as w,o as De,bA as X,l as Fe,z as Be,aw as Ve,x as He,y as Ue,B as Y,bB as Ee,Y as Pe,Q as g,R as A,$ as t,a0 as e,S as u,T as i,U as o,Z as b,W as _,a1 as B,bI as Te,ac as R,a2 as Z,H as Ge,ab as Ke,V as Ne,O as ee,af as Je,ag as te,bF as Le,ae as je,aM as qe,aN as We,bJ as Qe,bH as Xe,X as Ye}from"./index-ac57907e.js";import{S as Ze}from"./index-ffe7b967.js";/* empty css              *//* empty css              */import{c as et,d as tt,F as st}from"./FileItem-e3b6a812.js";import{M as at,L as lt,R as nt,f as ot}from"./MultiSelectKeep-5d38d223.js";import{c as it,u as rt}from"./hook-bebd7723.js";import{f as O,H as se,_ as dt,a as ut}from"./searchHistory-6db0685d.js";import"./functionalCallableComp-bacd8211.js";import"./index-9d56980e.js";import"./isArrayLikeObject-96b1e103.js";import"./_isIterateeCall-a8bdd540.js";import"./index-e1e78154.js";import"./shortcut-5c99090c.js";import"./Checkbox-a696edf2.js";/* empty css              */var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const pt=ct;function ae(c){for(var p=1;p<arguments.length;p++){var d=arguments[p]!=null?Object(arguments[p]):{},f=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(d).filter(function(h){return Object.getOwnPropertyDescriptor(d,h).enumerable}))),f.forEach(function(h){ft(c,h,d[h])})}return c}function ft(c,p,d){return p in c?Object.defineProperty(c,p,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[p]=d,c}var V=function(p,d){var f=ae({},p,d.attrs);return s(Me,ae({},f,{icon:pt}),null)};V.displayName="AimOutlined";V.inheritAttrs=!1;const vt=V,gt="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",H=c=>(qe("data-v-5145f12c"),c=c(),We(),c),mt={style:{"padding-right":"16px"}},ht=H(()=>u("div",null,null,-1)),_t=["title"],yt=["src"],bt={class:"search-bar"},wt={class:"form-name"},kt={class:"search-bar last actions"},St={class:"hint"},Ct={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},xt={style:{margin:"16px 32px 16px"}},It={style:{"padding-right":"16px"}},$t=H(()=>u("div",null,null,-1)),At=H(()=>u("div",{style:{padding:"16px 0 512px"}},null,-1)),Rt={key:2,class:"preview-switch"},Ot=ze({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(c){const p=c,d=w(!1),f=w(""),h=w(!1),k=w(p.searchScope??""),C=w(!1),U=w(0),M=it(l=>{const a={cursor:l,regexp:d.value?f.value:"",surstr:d.value?"":f.value,path_only:h.value,folder_paths:(k.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r)};return Qe(a)}),{queue:S,images:m,onContextMenuClickU:E,stackViewEl:le,previewIdx:x,previewing:P,onPreviewVisibleChange:ne,previewImgMove:T,canPreview:G,itemSize:K,gridItems:oe,showGenInfo:I,imageGenInfo:N,q:ie,multiSelectedIdxs:z,onFileItemClick:re,scroller:J,showMenuIdx:D,onFileDragStart:de,onFileDragEnd:ue,cellWidth:ce,onScroll:L,saveAllFileAsJson:pe,saveLoadedFileAsJson:fe,props:ve,changeIndchecked:ge,seedChangeChecked:me,getGenDiff:he,getGenDiffWatchDep:_e}=rt(M),v=w();De(async()=>{v.value=await X(),v.value.img_count&&v.value.expired&&await j(),p.searchScope&&await $()}),Fe(()=>p,async l=>{ve.value=l},{deep:!0,immediate:!0});const j=Be(()=>S.pushAction(async()=>(await Xe(),v.value=await X(),v.value)).res),q=l=>{f.value=l.substr,k.value=l.folder_paths_str,d.value=l.isRegex,C.value=!1,$()},$=async()=>{U.value++,O.value.add({substr:f.value,folder_paths_str:k.value,isRegex:d.value}),await M.reset({refetch:!0}),await Ve(),L(),J.value.scrollToItem(0),m.value.length||He.info(Ue("fuzzy-search-noResults"))};Y("returnToIIB",async()=>{const l=await S.pushAction(Ee).res;v.value.expired=l.expired}),Y("searchIndexExpired",()=>v.value&&(v.value.expired=!0));const ye=()=>{d.value=!d.value},be=Pe(),{onClearAllSelected:we,onSelectAll:ke,onReverseSelect:Se}=et();return(l,a)=>{const r=dt,y=ut,Ce=ee,xe=Je,W=te,Ie=Le,F=te,$e=je,Ae=ee,Re=Ze;return g(),A(Ne,null,[s(Ce,{visible:C.value,"onUpdate:visible":a[0]||(a[0]=n=>C.value=n),width:"70vw","mask-closable":"",onOk:a[1]||(a[1]=n=>C.value=!1)},{default:t(()=>[s(se,{records:e(O),onReuseRecord:q},{default:t(({record:n})=>[u("div",mt,[s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(g(),b(y,{key:0},{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):_("",!0),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),ht])]),_:1},8,["records"])]),_:1},8,["visible"]),u("div",{class:"container",ref_key:"stackViewEl",ref:le},[s(at,{show:!!e(z).length||e(be).keepMultiSelect,onClearAllSelected:e(we),onSelectAll:e(ke),onReverseSelect:e(Se)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),v.value?(g(),A("div",{key:0,class:"search-bar",onKeydown:a[6]||(a[6]=B(()=>{},["stop"]))},[s(xe,{value:f.value,"onUpdate:value":a[2]||(a[2]=n=>f.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(S).isIdle,onKeydown:Te($,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),u("div",{class:R(["regex-icon",{selected:h.value}]),onKeydown:a[3]||(a[3]=B(()=>{},["stop"])),onClick:a[4]||(a[4]=n=>h.value=!h.value),title:l.$t("pathOnly")},[s(e(vt))],42,_t),u("div",{class:R(["regex-icon",{selected:d.value}]),onKeydown:a[5]||(a[5]=B(()=>{},["stop"])),onClick:ye,title:"Use Regular Expression"},[u("img",{src:e(gt)},null,8,yt)],34),v.value.expired||!v.value.img_count?(g(),b(W,{key:0,onClick:e(j),loading:!e(S).isIdle,type:"primary"},{default:t(()=>[i(o(v.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(g(),b(W,{key:1,type:"primary",onClick:$,loading:!e(S).isIdle||e(M).loading,disabled:!f.value&&!k.value},{default:t(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):_("",!0),u("div",bt,[u("div",wt,o(l.$t("searchScope")),1),s(Ie,{"auto-size":{maxRows:8},value:k.value,"onUpdate:value":a[7]||(a[7]=n=>k.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),u("div",kt,[e(m).length?(g(),b(F,{key:0,onClick:e(fe)},{default:t(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):_("",!0),e(m).length?(g(),b(F,{key:1,onClick:e(pe)},{default:t(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):_("",!0),s(F,{onClick:a[8]||(a[8]=n=>C.value=!0)},{default:t(()=>[i(o(l.$t("history")),1)]),_:1})]),s(Re,{size:"large",spinning:!e(S).isIdle},{default:t(()=>[s(Ae,{visible:e(I),"onUpdate:visible":a[10]||(a[10]=n=>Z(I)?I.value=n:null),width:"70vw","mask-closable":"",onOk:a[11]||(a[11]=n=>I.value=!1)},{cancelText:t(()=>[]),default:t(()=>[s($e,{active:"",loading:!e(ie).isIdle},{default:t(()=>[u("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[9]||(a[9]=n=>e(Ge)(e(N)))},[u("div",St,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(N)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),U.value===0&&!e(m).length&&e(O).getRecords().length?(g(),A("div",Ct,[u("h2",xt,o(l.$t("restoreFromHistory")),1),s(se,{records:e(O),onReuseRecord:q},{default:t(({record:n})=>[u("div",It,[s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(g(),b(y,{key:0},{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):_("",!0),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),$t])]),_:1},8,["records"])])):_("",!0),e(m)?(g(),b(e(tt),{key:1,ref_key:"scroller",ref:J,class:"file-list",items:e(m),"item-size":e(K).first,"key-field":"fullpath","item-secondary-size":e(K).second,gridItems:e(oe),onScroll:e(L)},{after:t(()=>[At]),default:t(({item:n,index:Q})=>[s(st,{idx:Q,file:n,"show-menu-idx":e(D),"onUpdate:showMenuIdx":a[12]||(a[12]=Oe=>Z(D)?D.value=Oe:null),onFileItemClick:e(re),"full-screen-preview-image-url":e(m)[e(x)]?e(Ke)(e(m)[e(x)]):"","cell-width":e(ce),selected:e(z).includes(Q),onContextMenuClick:e(E),onDragstart:e(de),onDragend:e(ue),"enable-change-indicator":e(ge),"seed-change-checked":e(me),"get-gen-diff":e(he),"get-gen-diff-watch-dep":e(_e),"is-selected-mutil-files":e(z).length>1,onPreviewVisibleChange:e(ne)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):_("",!0),e(P)?(g(),A("div",Rt,[s(e(lt),{onClick:a[13]||(a[13]=n=>e(T)("prev")),class:R({disable:!e(G)("prev")})},null,8,["class"]),s(e(nt),{onClick:a[14]||(a[14]=n=>e(T)("next")),class:R({disable:!e(G)("next")})},null,8,["class"])])):_("",!0)]),_:1},8,["spinning"]),e(P)&&e(m)&&e(m)[e(x)]?(g(),b(ot,{key:1,file:e(m)[e(x)],idx:e(x),onContextMenuClick:e(E)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)],64)}}});const jt=Ye(Ot,[["__scopeId","data-v-5145f12c"]]);export{jt as default};
