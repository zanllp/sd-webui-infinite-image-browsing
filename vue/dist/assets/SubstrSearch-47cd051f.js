import{c as s,A as Me,d as Ve,r as b,o as De,cb as Y,m as Fe,C as Be,az as Ue,z as Ee,B as Te,E as Z,cc as He,a1 as Pe,U as m,V as A,a3 as t,a4 as e,W as u,X as i,Y as o,a2 as k,$ as _,a5 as F,cn as Ge,ag as R,a6 as ee,L as Ke,af as Le,Z as je,T as te,aj as Ne,ak as se,cg as qe,ai as Je,aP as We,aQ as Qe,co as Xe,ci as Ye,a0 as Ze}from"./index-e52903e1.js";import{S as et}from"./index-2400a55e.js";/* empty css              */import"./index-7132ec3f.js";import{c as tt,d as st,F as at}from"./FileItem-f4080a91.js";import{M as lt,o as nt,L as ot,R as it,f as rt}from"./MultiSelectKeep-5aff735b.js";import{c as dt,u as ut}from"./hook-9daf8141.js";import{f as O,H as ae,_ as ct,a as pt}from"./searchHistory-e912d9ff.js";import"./numInput.vue_vue_type_style_index_0_scoped_55978858_lang-0303141f.js";/* empty css              */import"./_isIterateeCall-6a7bc531.js";import"./index-a1963dde.js";import"./shortcut-48a3aaf1.js";import"./Checkbox-c11e7d8d.js";import"./index-9619ee85.js";import"./useGenInfoDiff-cdd80a4b.js";var ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const vt=ft;function le(c){for(var p=1;p<arguments.length;p++){var d=arguments[p]!=null?Object(arguments[p]):{},f=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(d).filter(function(h){return Object.getOwnPropertyDescriptor(d,h).enumerable}))),f.forEach(function(h){gt(c,h,d[h])})}return c}function gt(c,p,d){return p in c?Object.defineProperty(c,p,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[p]=d,c}var B=function(p,d){var f=le({},p,d.attrs);return s(Me,le({},f,{icon:vt}),null)};B.displayName="AimOutlined";B.inheritAttrs=!1;const mt=B,ht="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",U=c=>(We("data-v-b5838ec8"),c=c(),Qe(),c),_t={style:{"padding-right":"16px"}},yt=U(()=>u("div",null,null,-1)),kt=["title"],bt=["src"],wt={class:"search-bar"},St={class:"form-name"},Ct={class:"search-bar last actions"},xt={class:"hint"},It={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},$t={style:{margin:"16px 32px 16px"}},At={style:{"padding-right":"16px"}},Rt=U(()=>u("div",null,null,-1)),Ot=U(()=>u("div",{style:{padding:"16px 0 512px"}},null,-1)),zt={key:2,class:"preview-switch"},Mt=Ve({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(c){const p=c,d=b(!1),f=b(""),h=b(!1),w=b(p.searchScope??""),C=b(!1),E=b(0),z=dt(l=>{const a={cursor:l,regexp:d.value?f.value:"",surstr:d.value?"":f.value,path_only:h.value,folder_paths:(w.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r)};return Xe(a)}),{queue:S,images:v,onContextMenuClickU:T,stackViewEl:ne,previewIdx:x,previewing:H,onPreviewVisibleChange:oe,previewImgMove:P,canPreview:G,itemSize:K,gridItems:ie,showGenInfo:I,imageGenInfo:L,q:re,multiSelectedIdxs:M,onFileItemClick:de,scroller:j,showMenuIdx:V,onFileDragStart:ue,onFileDragEnd:ce,cellWidth:pe,onScroll:N,saveAllFileAsJson:fe,saveLoadedFileAsJson:ve,props:ge,changeIndchecked:me,seedChangeChecked:he,getGenDiff:_e,getGenDiffWatchDep:ye}=ut(z),g=b();De(async()=>{g.value=await Y(),g.value.img_count&&g.value.expired&&await q(),p.searchScope&&await $()}),Fe(()=>p,async l=>{ge.value=l},{deep:!0,immediate:!0});const q=Be(()=>S.pushAction(async()=>(await Ye(),g.value=await Y(),g.value)).res),J=l=>{f.value=l.substr,w.value=l.folder_paths_str,d.value=l.isRegex,C.value=!1,$()},$=async()=>{E.value++,O.value.add({substr:f.value,folder_paths_str:w.value,isRegex:d.value}),await z.reset({refetch:!0}),await Ue(),N(),j.value.scrollToItem(0),v.value.length||Ee.info(Te("fuzzy-search-noResults"))};Z("returnToIIB",async()=>{const l=await S.pushAction(He).res;g.value.expired=l.expired}),Z("searchIndexExpired",()=>g.value&&(g.value.expired=!0));const ke=()=>{d.value=!d.value},be=Pe(),{onClearAllSelected:we,onSelectAll:Se,onReverseSelect:Ce}=tt();return(l,a)=>{const r=ct,y=pt,xe=te,Ie=Ne,W=se,$e=qe,D=se,Ae=Je,Re=te,Oe=et;return m(),A(je,null,[s(xe,{visible:C.value,"onUpdate:visible":a[0]||(a[0]=n=>C.value=n),width:"70vw","mask-closable":"",onOk:a[1]||(a[1]=n=>C.value=!1)},{default:t(()=>[s(ae,{records:e(O),onReuseRecord:J},{default:t(({record:n})=>[u("div",_t,[s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(m(),k(y,{key:0},{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):_("",!0),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),yt])]),_:1},8,["records"])]),_:1},8,["visible"]),u("div",{class:"container",ref_key:"stackViewEl",ref:ne},[s(lt,{show:!!e(M).length||e(be).keepMultiSelect,onClearAllSelected:e(we),onSelectAll:e(Se),onReverseSelect:e(Ce)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),g.value?(m(),A("div",{key:0,class:"search-bar",onKeydown:a[6]||(a[6]=F(()=>{},["stop"]))},[s(Ie,{value:f.value,"onUpdate:value":a[2]||(a[2]=n=>f.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(S).isIdle,onKeydown:Ge($,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),u("div",{class:R(["regex-icon",{selected:h.value}]),onKeydown:a[3]||(a[3]=F(()=>{},["stop"])),onClick:a[4]||(a[4]=n=>h.value=!h.value),title:l.$t("pathOnly")},[s(e(mt))],42,kt),u("div",{class:R(["regex-icon",{selected:d.value}]),onKeydown:a[5]||(a[5]=F(()=>{},["stop"])),onClick:ke,title:"Use Regular Expression"},[u("img",{src:e(ht)},null,8,bt)],34),g.value.expired||!g.value.img_count?(m(),k(W,{key:0,onClick:e(q),loading:!e(S).isIdle,type:"primary"},{default:t(()=>[i(o(g.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(m(),k(W,{key:1,type:"primary",onClick:$,loading:!e(S).isIdle||e(z).loading,disabled:!f.value&&!w.value},{default:t(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):_("",!0),u("div",wt,[u("div",St,o(l.$t("searchScope")),1),s($e,{"auto-size":{maxRows:8},value:w.value,"onUpdate:value":a[7]||(a[7]=n=>w.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),u("div",Ct,[e(v).length?(m(),k(D,{key:0,onClick:e(ve)},{default:t(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):_("",!0),e(v).length?(m(),k(D,{key:1,onClick:e(fe)},{default:t(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):_("",!0),s(D,{onClick:a[8]||(a[8]=n=>C.value=!0)},{default:t(()=>[i(o(l.$t("history")),1)]),_:1})]),s(Oe,{size:"large",spinning:!e(S).isIdle},{default:t(()=>[s(Re,{visible:e(I),"onUpdate:visible":a[10]||(a[10]=n=>ee(I)?I.value=n:null),width:"70vw","mask-closable":"",onOk:a[11]||(a[11]=n=>I.value=!1)},{cancelText:t(()=>[]),default:t(()=>[s(Ae,{active:"",loading:!e(re).isIdle},{default:t(()=>[u("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[9]||(a[9]=n=>e(Ke)(e(L)))},[u("div",xt,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(L)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),E.value===0&&!e(v).length&&e(O).getRecords().length?(m(),A("div",It,[u("h2",$t,o(l.$t("restoreFromHistory")),1),s(ae,{records:e(O),onReuseRecord:J},{default:t(({record:n})=>[u("div",At,[s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(m(),k(y,{key:0},{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):_("",!0),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),Rt])]),_:1},8,["records"])])):_("",!0),e(v)?(m(),k(e(st),{key:1,ref_key:"scroller",ref:j,class:"file-list",items:e(v),"item-size":e(K).first,"key-field":"fullpath","item-secondary-size":e(K).second,gridItems:e(ie),onScroll:e(N)},{after:t(()=>[Ot]),default:t(({item:n,index:Q})=>[s(at,{idx:Q,file:n,"show-menu-idx":e(V),"onUpdate:showMenuIdx":a[12]||(a[12]=X=>ee(V)?V.value=X:null),onFileItemClick:e(de),"full-screen-preview-image-url":e(v)[e(x)]?e(Le)(e(v)[e(x)]):"","cell-width":e(pe),selected:e(M).includes(Q),onContextMenuClick:e(T),onDragstart:e(ue),onDragend:e(ce),onTiktokView:(X,ze)=>e(nt)(e(v),ze),"enable-change-indicator":e(me),"seed-change-checked":e(he),"get-gen-diff":e(_e),"get-gen-diff-watch-dep":e(ye),"is-selected-mutil-files":e(M).length>1,onPreviewVisibleChange:e(oe)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onTiktokView","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):_("",!0),e(H)?(m(),A("div",zt,[s(e(ot),{onClick:a[13]||(a[13]=n=>e(P)("prev")),class:R({disable:!e(G)("prev")})},null,8,["class"]),s(e(it),{onClick:a[14]||(a[14]=n=>e(P)("next")),class:R({disable:!e(G)("next")})},null,8,["class"])])):_("",!0)]),_:1},8,["spinning"]),e(H)&&e(v)&&e(v)[e(x)]?(m(),k(rt,{key:1,file:e(v)[e(x)],idx:e(x),onContextMenuClick:e(T)},null,8,["file","idx","onContextMenuClick"])):_("",!0)],512)],64)}}});const Wt=Ze(Mt,[["__scopeId","data-v-b5838ec8"]]);export{Wt as default};
