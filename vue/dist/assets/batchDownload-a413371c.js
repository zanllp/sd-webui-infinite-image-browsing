import{d as F,r as $,cG as B,c3 as S,o as _,k as w,l as f,c as l,y as p,m as d,t as c,z as s,x,O as A,cH as R,cI as y,ag as E,ae as T,W as V,q as N}from"./index-2865012e.js";import{_ as U}from"./index-85cde8a2.js";import{F as H,s as L}from"./FileItem-3bb21719.js";import{u as O,b as j,j as q}from"./index-9ff6b146.js";import"./index-cc5bdcee.js";import"./index-f200274c.js";import"./index-50dada2e.js";import"./shortcut-7cf3ed76.js";import"./index-dfe4c7be.js";import"./_isIterateeCall-3cdb292e.js";const G={class:"actions-panel actions"},W={class:"item"},P={key:0,class:"file-list"},Q={class:"hint"},J=F({__name:"batchDownload",props:{tabIdx:{},paneIdx:{},id:{}},setup(K){const{stackViewEl:b}=O().toRefs(),{itemSize:h,gridItems:D,cellWidth:g}=j(),i=$(),m=q(),{selectdFiles:a}=B(m),r=S(),v=async e=>{const t=R(e);t&&m.addFiles(t.nodes)},C=async()=>{r.pushAction(async()=>{const e=await y.value.post("/zip",{paths:a.value.map(u=>u.fullpath),compress:i.batchDownloadCompress,pack_only:!1},{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=t,o.setAttribute("download",`iib_${new Date().toLocaleString()}.zip`),document.body.appendChild(o),o.click()})},I=async()=>{r.pushAction(async()=>{await y.value.post("/zip",{paths:a.value.map(e=>e.fullpath),compress:i.batchDownloadCompress,pack_only:!0},{responseType:"blob"}),E.success(T("success"))})},z=e=>{a.value.splice(e,1)};return(e,t)=>{const o=V,u=U;return _(),w("div",{class:"container",ref_key:"stackViewEl",ref:b,onDrop:v},[f("div",G,[l(o,{onClick:t[0]||(t[0]=n=>s(m).selectdFiles=[])},{default:p(()=>[d(c(e.$t("clear")),1)]),_:1}),f("div",W,[d(c(e.$t("compressFile"))+": ",1),l(u,{checked:s(i).batchDownloadCompress,"onUpdate:checked":t[1]||(t[1]=n=>s(i).batchDownloadCompress=n)},null,8,["checked"])]),l(o,{onClick:I,type:"primary",loading:!s(r).isIdle},{default:p(()=>[d(c(e.$t("packOnlyNotDownload")),1)]),_:1},8,["loading"]),l(o,{onClick:C,type:"primary",loading:!s(r).isIdle},{default:p(()=>[d(c(e.$t("zipDownload")),1)]),_:1},8,["loading"])]),s(a).length?(_(),x(s(L),{key:1,ref:"scroller",class:"file-list",items:s(a).slice(),"item-size":s(h).first,"key-field":"fullpath","item-secondary-size":s(h).second,gridItems:s(D)},{default:p(({item:n,index:k})=>[l(H,{idx:k,file:n,"cell-width":s(g),"enable-close-icon":"",onCloseIconClick:M=>z(k),"full-screen-preview-image-url":s(A)(n),"enable-right-click-menu":!1},null,8,["idx","file","cell-width","onCloseIconClick","full-screen-preview-image-url"])]),_:1},8,["items","item-size","item-secondary-size","gridItems"])):(_(),w("div",P,[f("p",Q,c(e.$t("batchDownloaDDragAndDropHint")),1)]))],544)}}});const ce=N(J,[["__scopeId","data-v-a2642a17"]]);export{ce as default};
