import{d as ke,$ as he,v as C,ad as z,r as ve,o as u,k as S,c as n,z as e,y as o,C as G,l as d,E as we,t as a,m as p,x as U,O as Ie,aJ as _e,p as b,Q as E,T as Ce,U as Se,W as J,aB as be,aC as ye,bv as xe,q as Me}from"./index-7f89456f.js";import{S as Te}from"./index-485761d2.js";import{_ as Ae}from"./index-ec397928.js";import{L as $e,R as Ve,f as De,M as Fe}from"./MultiSelectKeep-259a7683.js";import{s as Be,F as Re}from"./FileItem-71fdd7ed.js";import{c as ze,u as Ge}from"./hook-2b75627d.js";import{g as Ue,o as N}from"./index-d3fa759a.js";import"./index-08e1e48f.js";import"./index-8dbe984d.js";import"./index-31a27e12.js";import"./index-7ba6e156.js";import"./shortcut-7f420da3.js";import"./_isIterateeCall-eac05144.js";const Ee=r=>(be("data-v-6e837a6f"),r=r(),ye(),r),Je={class:"hint"},Ne={class:"action-bar"},Le=Ee(()=>d("div",{style:{padding:"16px 0 512px"}},null,-1)),Oe={key:1},Pe={class:"no-res-hint"},We={class:"hint"},qe={key:2,class:"preview-switch"},Ke=ke({__name:"MatchedImageGrid",props:{tabIdx:{},paneIdx:{},selectedTagIds:{},id:{}},setup(r){const k=r,m=he(!1),g=ze(t=>xe({...k.selectedTagIds,random_sort:m.value},t)),{queue:L,images:s,onContextMenuClickU:y,stackViewEl:O,previewIdx:c,previewing:x,onPreviewVisibleChange:P,previewImgMove:M,canPreview:T,itemSize:A,gridItems:W,showGenInfo:f,imageGenInfo:$,q,multiSelectedIdxs:h,onFileItemClick:K,scroller:v,showMenuIdx:w,onFileDragStart:Q,onFileDragEnd:j,cellWidth:H,onScroll:I,saveAllFileAsJson:X,props:Y,saveLoadedFileAsJson:Z,changeIndchecked:ee,seedChangeChecked:te,getGenDiff:le,getGenDiffWatchDep:ne}=Ge(g);C(()=>k.selectedTagIds,async()=>{var t;await g.reset(),await z(),(t=v.value)==null||t.scrollToItem(0),I()},{immediate:!0}),C(m,async()=>{var t;await g.reset(),await z(),(t=v.value)==null||t.scrollToItem(0),I()}),C(()=>k,async t=>{Y.value=t},{deep:!0,immediate:!0});const se=ve(),{onClearAllSelected:ie,onSelectAll:oe,onReverseSelect:ae}=Ue(),de=()=>{s.value.length!==0&&N(s.value,0)};return(t,l)=>{const re=Fe,ce=Ce,ue=Se,pe=Ae,_=J,me=J,ge=Te;return u(),S("div",{class:"container",ref_key:"stackViewEl",ref:O},[n(re,{show:!!e(h).length||e(se).keepMultiSelect,onClearAllSelected:e(ie),onSelectAll:e(oe),onReverseSelect:e(ae)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),n(ge,{size:"large",spinning:!e(L).isIdle},{default:o(()=>{var V,D,F;return[n(ue,{visible:e(f),"onUpdate:visible":l[1]||(l[1]=i=>G(f)?f.value=i:null),width:"70vw","mask-closable":"",onOk:l[2]||(l[2]=i=>f.value=!1)},{cancelText:o(()=>[]),default:o(()=>[n(ce,{active:"",loading:!e(q).isIdle},{default:o(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[0]||(l[0]=i=>e(we)(e($)))},[d("div",Je,a(t.$t("doubleClickToCopy")),1),p(" "+a(e($)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),d("div",Ne,[n(pe,{checked:m.value,"onUpdate:checked":l[3]||(l[3]=i=>m.value=i),"checked-children":t.$t("randomSort"),"un-checked-children":t.$t("sortByDate")},null,8,["checked","checked-children","un-checked-children"]),n(_,{onClick:de,disabled:!((V=e(s))!=null&&V.length)},{default:o(()=>[p(a(t.$t("tiktokView")),1)]),_:1},8,["disabled"]),n(_,{onClick:e(Z)},{default:o(()=>[p(a(t.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),n(_,{onClick:e(X)},{default:o(()=>[p(a(t.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),(D=e(s))!=null&&D.length?(u(),U(e(Be),{key:0,ref_key:"scroller",ref:v,class:"file-list",items:e(s),"item-size":e(A).first,"key-field":"fullpath","item-secondary-size":e(A).second,gridItems:e(W),onScroll:e(I)},{after:o(()=>[Le]),default:o(({item:i,index:B})=>[n(Re,{idx:B,file:i,"cell-width":e(H),"show-menu-idx":e(w),"onUpdate:showMenuIdx":l[4]||(l[4]=R=>G(w)?w.value=R:null),onDragstart:e(Q),onDragend:e(j),onFileItemClick:e(K),onTiktokView:(R,fe)=>e(N)(e(s),fe),"full-screen-preview-image-url":e(s)[e(c)]?e(Ie)(e(s)[e(c)]):"",selected:e(h).includes(B),onContextMenuClick:e(y),onPreviewVisibleChange:e(P),"is-selected-mutil-files":e(h).length>1,"enable-change-indicator":e(ee),"seed-change-checked":e(te),"get-gen-diff":e(le),"get-gen-diff-watch-dep":e(ne)},null,8,["idx","file","cell-width","show-menu-idx","onDragstart","onDragend","onFileItemClick","onTiktokView","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange","is-selected-mutil-files","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):e(g).load&&t.selectedTagIds.and_tags.length===1&&!((F=t.selectedTagIds.folder_paths_str)!=null&&F.trim())?(u(),S("div",Oe,[d("div",Pe,[d("p",We,a(t.$t("tagSearchNoResultsMessage")),1),n(me,{onClick:l[5]||(l[5]=i=>e(_e)()),type:"primary"},{default:o(()=>[p(a(t.$t("rebuildImageIndex")),1)]),_:1})])])):b("",!0),e(x)?(u(),S("div",qe,[n(e($e),{onClick:l[6]||(l[6]=i=>e(M)("prev")),class:E({disable:!e(T)("prev")})},null,8,["class"]),n(e(Ve),{onClick:l[7]||(l[7]=i=>e(M)("next")),class:E({disable:!e(T)("next")})},null,8,["class"])])):b("",!0)]}),_:1},8,["spinning"]),e(x)&&e(s)&&e(s)[e(c)]?(u(),U(De,{key:0,file:e(s)[e(c)],idx:e(c),onContextMenuClick:e(y)},null,8,["file","idx","onContextMenuClick"])):b("",!0)],512)}}});const at=Me(Ke,[["__scopeId","data-v-6e837a6f"]]);export{at as default};
