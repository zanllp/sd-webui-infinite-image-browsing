import{c as a,A as Fe,d as Be,c0 as Ue,$ as b,at as Ee,c4 as te,v as He,c6 as Pe,c7 as Ge,ad as Ke,ag as je,ae as qe,c5 as ae,c8 as Le,r as Ne,o as f,k as B,y as t,z as e,l as d,m as o,t as i,x as y,p as k,B as U,ci as Je,Q as O,C as le,E as We,O as Qe,n as Xe,U as se,V as Ye,cj as Ze,R as et,W as ne,cc as tt,T as at,aB as lt,aC as st,ck as nt,q as it}from"./index-7225f789.js";import{S as ot}from"./index-f51c8eac.js";/* empty css              */import"./index-cde54501.js";/* empty css              */import"./index-3e70eb76.js";import{s as rt,F as dt}from"./FileItem-d91e976e.js";import{M as ut,L as ct,R as pt,f as ft}from"./MultiSelectKeep-7de9332b.js";import{c as vt,u as mt}from"./hook-af7b931d.js";import{g as gt,o as _t}from"./index-dc3e0a9f.js";import{f as M,H as ie,_ as ht,a as yt}from"./searchHistory-c2370df2.js";import"./index-55ee7fd8.js";import"./index-f79230f7.js";import"./index-9fffc74f.js";import"./index-5b20e901.js";import"./index-02b34fbc.js";import"./shortcut-afd6d8ae.js";import"./_isIterateeCall-3d9f4398.js";var kt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const bt=kt;function oe(u){for(var c=1;c<arguments.length;c++){var g=arguments[c]!=null?Object(arguments[c]):{},p=Object.keys(g);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(g).filter(function(_){return Object.getOwnPropertyDescriptor(g,_).enumerable}))),p.forEach(function(_){wt(u,_,g[_])})}return u}function wt(u,c,g){return c in u?Object.defineProperty(u,c,{value:g,enumerable:!0,configurable:!0,writable:!0}):u[c]=g,u}var E=function(c,g){var p=oe({},c,g.attrs);return a(Fe,oe({},p,{icon:bt}),null)};E.displayName="AimOutlined";E.inheritAttrs=!1;const St=E,Ct="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",H=u=>(lt("data-v-e1bd92bd"),u=u(),st(),u),xt={style:{"padding-right":"16px"}},It=H(()=>d("div",null,null,-1)),$t=["title"],At=["src"],Rt={class:"search-bar"},Ot={class:"form-name"},Mt={class:"search-bar last actions"},Tt={class:"hint"},zt={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},Vt={style:{margin:"16px 32px 16px"}},Dt={style:{"padding-right":"16px"}},Ft=H(()=>d("div",null,null,-1)),Bt=H(()=>d("div",{style:{padding:"16px 0 512px"}},null,-1)),Ut={key:2,class:"preview-switch"},Et=Be({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(u){const c=u,g=Ue(),p=b(!1),_=b(""),$=b(!1),S=b(c.searchScope??""),C=b(!1),P=b(0),x=b("all"),T=vt(l=>{const s={cursor:l,regexp:p.value?_.value:"",surstr:p.value?"":_.value,path_only:$.value,folder_paths:(S.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r),media_type:x.value};return nt(s)}),{queue:w,images:v,onContextMenuClickU:G,stackViewEl:re,previewIdx:I,previewing:K,onPreviewVisibleChange:de,previewImgMove:j,canPreview:q,itemSize:L,gridItems:ue,showGenInfo:A,imageGenInfo:N,q:ce,multiSelectedIdxs:z,onFileItemClick:pe,scroller:J,showMenuIdx:V,onFileDragStart:fe,onFileDragEnd:ve,cellWidth:me,onScroll:W,saveAllFileAsJson:ge,saveLoadedFileAsJson:_e,props:he,changeIndchecked:ye,seedChangeChecked:ke,getGenDiff:be,getGenDiffWatchDep:we}=mt(T),m=b();Ee(async()=>{m.value=await te(),m.value.img_count&&m.value.expired&&await Q(),c.searchScope&&await R()}),He(()=>c,async l=>{he.value=l},{deep:!0,immediate:!0});const Q=Pe(()=>w.pushAction(async()=>(await Ge(),m.value=await te(),g.tagMap.clear(),m.value)).res),X=l=>{_.value=l.substr,S.value=l.folder_paths_str,p.value=l.isRegex,x.value=l.mediaType||"all",C.value=!1,R()},R=async()=>{P.value++,M.value.add({substr:_.value,folder_paths_str:S.value,isRegex:p.value,mediaType:x.value}),await T.reset({refetch:!0}),await Ke(),W(),J.value.scrollToItem(0),v.value.length||je.info(qe("fuzzy-search-noResults"))};ae("returnToIIB",async()=>{const l=await w.pushAction(Le).res;m.value.expired=l.expired}),ae("searchIndexExpired",()=>m.value&&(m.value.expired=!0));const Se=()=>{p.value=!p.value},Ce=Ne(),{onClearAllSelected:xe,onSelectAll:Ie,onReverseSelect:$e}=gt();return(l,s)=>{const r=ht,h=yt,Ae=se,Re=Ye,D=Ze,Oe=et,Y=ne,Me=tt,F=ne,Te=at,ze=se,Ve=ot;return f(),B(Xe,null,[a(Ae,{visible:C.value,"onUpdate:visible":s[0]||(s[0]=n=>C.value=n),width:"70vw","mask-closable":"",onOk:s[1]||(s[1]=n=>C.value=!1)},{default:t(()=>[a(ie,{records:e(M),onReuseRecord:X},{default:t(({record:n})=>[d("div",xt,[a(h,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(f(),y(h,{key:0},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("searchScope"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):k("",!0),a(h,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(f(),y(h,{key:1},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("mediaType"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.mediaType),1)]),_:2},1024)]),_:2},1024)):k("",!0),a(h,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("time"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.time),1)]),_:2},1024)]),_:2},1024),It])]),_:1},8,["records"])]),_:1},8,["visible"]),d("div",{class:"container",ref_key:"stackViewEl",ref:re},[a(ut,{show:!!e(z).length||e(Ce).keepMultiSelect,onClearAllSelected:e(xe),onSelectAll:e(Ie),onReverseSelect:e($e)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),d("div",{class:"search-bar",onKeydown:s[7]||(s[7]=U(()=>{},["stop"]))},[a(Re,{value:_.value,"onUpdate:value":s[2]||(s[2]=n=>_.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(w).isIdle,onKeydown:Je(R,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),a(Oe,{value:x.value,"onUpdate:value":s[3]||(s[3]=n=>x.value=n),style:{width:"100px",margin:"0 4px"},disabled:!e(w).isIdle},{default:t(()=>[a(D,{value:"all"},{default:t(()=>[o(i(l.$t("all")),1)]),_:1}),a(D,{value:"image"},{default:t(()=>[o(i(l.$t("image")),1)]),_:1}),a(D,{value:"video"},{default:t(()=>[o(i(l.$t("video")),1)]),_:1})]),_:1},8,["value","disabled"]),d("div",{class:O(["regex-icon",{selected:$.value}]),onKeydown:s[4]||(s[4]=U(()=>{},["stop"])),onClick:s[5]||(s[5]=n=>$.value=!$.value),title:l.$t("pathOnly")},[a(e(St))],42,$t),d("div",{class:O(["regex-icon",{selected:p.value}]),onKeydown:s[6]||(s[6]=U(()=>{},["stop"])),onClick:Se,title:"Use Regular Expression"},[d("img",{src:e(Ct)},null,8,At)],34),m.value&&(m.value.expired||!m.value.img_count)?(f(),y(Y,{key:0,onClick:e(Q),loading:!e(w).isIdle,type:"primary"},{default:t(()=>[o(i(m.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(f(),y(Y,{key:1,type:"primary",onClick:R,loading:!e(w).isIdle||e(T).loading},{default:t(()=>[o(i(l.$t("search")),1)]),_:1},8,["loading"]))],32),d("div",Rt,[d("div",Ot,i(l.$t("searchScope")),1),a(Me,{"auto-size":{maxRows:8},value:S.value,"onUpdate:value":s[8]||(s[8]=n=>S.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),d("div",Mt,[e(v).length?(f(),y(F,{key:0,onClick:e(_e)},{default:t(()=>[o(i(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):k("",!0),e(v).length?(f(),y(F,{key:1,onClick:e(ge)},{default:t(()=>[o(i(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):k("",!0),a(F,{onClick:s[9]||(s[9]=n=>C.value=!0)},{default:t(()=>[o(i(l.$t("history")),1)]),_:1})]),a(Ve,{size:"large",spinning:!e(w).isIdle},{default:t(()=>[a(ze,{visible:e(A),"onUpdate:visible":s[11]||(s[11]=n=>le(A)?A.value=n:null),width:"70vw","mask-closable":"",onOk:s[12]||(s[12]=n=>A.value=!1)},{cancelText:t(()=>[]),default:t(()=>[a(Te,{active:"",loading:!e(ce).isIdle},{default:t(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[10]||(s[10]=n=>e(We)(e(N)))},[d("div",Tt,i(l.$t("doubleClickToCopy")),1),o(" "+i(e(N)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),P.value===0&&!e(v).length&&e(M).getRecords().length?(f(),B("div",zt,[d("h2",Vt,i(l.$t("restoreFromHistory")),1),a(ie,{records:e(M),onReuseRecord:X},{default:t(({record:n})=>[d("div",Dt,[a(h,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(f(),y(h,{key:0},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("searchScope"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):k("",!0),a(h,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(f(),y(h,{key:1},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("mediaType"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.mediaType),1)]),_:2},1024)]),_:2},1024)):k("",!0),a(h,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("time"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.time),1)]),_:2},1024)]),_:2},1024),Ft])]),_:1},8,["records"])])):k("",!0),e(v)?(f(),y(e(rt),{key:1,ref_key:"scroller",ref:J,class:"file-list",items:e(v),"item-size":e(L).first,"key-field":"fullpath","item-secondary-size":e(L).second,gridItems:e(ue),onScroll:e(W)},{after:t(()=>[Bt]),default:t(({item:n,index:Z})=>[a(dt,{idx:Z,file:n,"show-menu-idx":e(V),"onUpdate:showMenuIdx":s[13]||(s[13]=ee=>le(V)?V.value=ee:null),onFileItemClick:e(pe),"full-screen-preview-image-url":e(v)[e(I)]?e(Qe)(e(v)[e(I)]):"","cell-width":e(me),selected:e(z).includes(Z),onContextMenuClick:e(G),onDragstart:e(fe),onDragend:e(ve),onTiktokView:(ee,De)=>e(_t)(e(v),De),"enable-change-indicator":e(ye),"seed-change-checked":e(ke),"get-gen-diff":e(be),"get-gen-diff-watch-dep":e(we),"is-selected-mutil-files":e(z).length>1,onPreviewVisibleChange:e(de)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onTiktokView","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):k("",!0),e(K)?(f(),B("div",Ut,[a(e(ct),{onClick:s[14]||(s[14]=n=>e(j)("prev")),class:O({disable:!e(q)("prev")})},null,8,["class"]),a(e(pt),{onClick:s[15]||(s[15]=n=>e(j)("next")),class:O({disable:!e(q)("next")})},null,8,["class"])])):k("",!0)]),_:1},8,["spinning"]),e(K)&&e(v)&&e(v)[e(I)]?(f(),y(ft,{key:0,file:e(v)[e(I)],idx:e(I),onContextMenuClick:e(G)},null,8,["file","idx","onContextMenuClick"])):k("",!0)],512)],64)}}});const sa=it(Et,[["__scopeId","data-v-e1bd92bd"]]);export{sa as default};
